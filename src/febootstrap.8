.\" Automatically generated by Pod::Man 2.25 (Pod::Simple 3.20)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "FEBOOTSTRAP 8"
.TH FEBOOTSTRAP 8 "2012-08-31" "febootstrap-3.20" "Virtualization Support"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
febootstrap \- Bootstrapping tool for creating supermin appliances
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 2
\& febootstrap [\-o OUTPUTDIR] \-\-names LIST OF PKGS ...
\& febootstrap [\-o OUTPUTDIR] PKG FILE NAMES ...
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
febootstrap is a tool for building supermin appliances.  These are
tiny appliances (similar to virtual machines), usually around 100KB in
size, which get fully instantiated on-the-fly in a fraction of a
second when you need to boot one of them.
.PP
Originally \*(L"fe\*(R" in febootstrap stood for \*(L"Fedora\*(R", but this tool is
now distro-independent and can build supermin appliances for several
popular Linux distros, and adding support for others is reasonably
easy.
.PP
Note that this manual page documents febootstrap 3.x which is a
complete rewrite and quite different from version 2.x.  If you are
looking for the febootstrap 2.x tools, then this is not the right
place.
.SS "\s-1BASIC\s0 \s-1OPERATION\s0"
.IX Subsection "BASIC OPERATION"
There are two modes for using febootstrap.  With the \fI\-\-names\fR
parameter, febootstrap takes a list of package names and creates a
supermin appliance containing those packages and all dependencies that
those packages require.  In this mode febootstrap usually needs
network access because it may need to consult package repositories in
order to work out dependencies and download packages.
.PP
Without \fI\-\-names\fR, febootstrap takes a list of packages (ie.
filenames of locally available packages).  This package set must be
complete and consistent with no dependencies outside the set of
packages you provide.  In this mode febootstrap does not require any
network access.  It works by looking at the package files themselves.
.PP
By \*(L"package\*(R" we mean the \s-1RPM\s0, \s-1DEB\s0, (etc.) package.  A package name
might be the fully qualified name (eg. \f(CW\*(C`coreutils\-8.5\-7.fc14.x86_64\*(C'\fR)
or some abbreviation (eg. \f(CW\*(C`coreutils\*(C'\fR).  The precise format of the
name and what abbreviations are allowed depends on the package
manager.
.PP
The supermin appliance that febootstrap writes consists of two files
called \f(CW\*(C`hostfiles\*(C'\fR and \f(CW\*(C`base.img\*(C'\fR (see \*(L"\s-1SUPERMIN\s0 \s-1APPLIANCES\s0\*(R"
below).  By default these are written to the current directory.  If
you specify the \fI\-o \s-1OUTPUTDIR\s0\fR option then these files are written to
the named directory instead (traditionally this directory is named
\&\f(CW\*(C`supermin.d\*(C'\fR but you can call it whatever you want).
.PP
In all cases febootstrap can only build a supermin appliance which is
identical in distro, version and architecture to the host.  It does
\&\fInot\fR do cross-builds.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-\-help\fR" 4
.IX Item "--help"
Display brief command line usage, and exit.
.IP "\fB\-\-exclude \s-1REGEXP\s0\fR" 4
.IX Item "--exclude REGEXP"
After doing dependency resolution, exclude packages which match the
regular expression.
.Sp
This option is only used with \fI\-\-names\fR, and it can be given multiple
times on the command line.
.IP "\fB\-\-names\fR" 4
.IX Item "--names"
Provide a list of package names, instead of providing packages
directly.  In this mode febootstrap may require network access.  See
\&\*(L"\s-1BASIC\s0 \s-1OPERATION\s0\*(R" above.
.IP "\fB\-\-no\-warnings\fR" 4
.IX Item "--no-warnings"
Don't print warnings about packaging problems.
.IP "\fB\-o outputdir\fR" 4
.IX Item "-o outputdir"
Select the output directory where the two supermin appliance files are
written (\f(CW\*(C`hostfiles\*(C'\fR and \f(CW\*(C`base.img\*(C'\fR).  The default directory is the
current directory.  Note that if this files exist already in the
output directory then they will be overwritten.
.IP "\fB\-\-save\-temps\fR" 4
.IX Item "--save-temps"
Don't remove temporary files and directories on exit.  This is useful
for debugging.
.IP "\fB\-\-use\-installed\fR" 4
.IX Item "--use-installed"
If packages are already installed, use the contents (from the local
filesystem) instead of downloading them.
.Sp
Note that this can cause malformed appliances if local files have been
changed from what was originally in the package.  This is particularly
a problem for configuration files.
.Sp
However this option is useful in some controlled situations: for
example when using febootstrap inside a freshly installed chroot.
.IP "\fB\-v\fR" 4
.IX Item "-v"
.PD 0
.IP "\fB\-\-verbose\fR" 4
.IX Item "--verbose"
.PD
Enable verbose messages.
.IP "\fB\-V\fR" 4
.IX Item "-V"
.PD 0
.IP "\fB\-\-version\fR" 4
.IX Item "--version"
.PD
Print the package name and version number, and exit.
.IP "\fB\-\-yum\-config \s-1CONFIGFILE\s0\fR" 4
.IX Item "--yum-config CONFIGFILE"
(Yum/RPM package handler only).  Use an alternate configuration file
instead of \f(CW\*(C`/etc/yum.conf\*(C'\fR.  If you also want to specify alternate
repositories then you can put them in this file directly or add a
\&\f(CW\*(C`reposdir\*(C'\fR option to this file.  For more information on the file
format see \fIyum.conf\fR\|(5).
.SH "SUPERMIN APPLIANCES"
.IX Header "SUPERMIN APPLIANCES"
Supermin appliances consist of just enough information to be able to
build an appliance containing the same operating system (Linux
version, distro, release etc) as the host \s-1OS\s0.  Since the host and
appliance share many common files such as \f(CW\*(C`/bin/bash\*(C'\fR and
\&\f(CW\*(C`/lib/libc.so\*(C'\fR there is no reason to ship these files in the
appliance.  They can simply be read from the host on demand when the
appliance is launched.  Therefore to save space we just store the
names of the host files that we want.
.PP
There are some files which cannot just be copied from the host in this
way.  These include configuration files which the host admin might
have edited.  So along with the list of host files, we also store a
skeleton base image which contains these files and the outline
directory structure.
.PP
Therefore the supermin appliance normally consists of at least two
control files:
.IP "\fBhostfiles\fR" 4
.IX Item "hostfiles"
The list of files that are to be copied from the host.  This is a
plain text file with one pathname per line.  Directories are included
in this file.
.Sp
Paths can contain wildcards, which are expanded when the appliance
is created, eg:
.Sp
.Vb 1
\& /etc/yum.repos.d/*.repo
.Ve
.Sp
would copy all of the \f(CW\*(C`*.repo\*(C'\fR files into the appliance.
.Sp
Each pathname in the file should start with a \f(CW\*(C`/\*(C'\fR character.  (In
older versions of febootstrap, paths started with \f(CW\*(C`./\*(C'\fR and were
relative to the root directory, but you should not do that in new
files).
.IP "\fBbase.img\fR" 4
.IX Item "base.img"
This uncompressed cpio file contains the skeleton filesystem.  Mostly
it contains directories and a few configuration files.
.Sp
All paths in the cpio file should be relative to the root directory of
the appliance.
.Sp
Note that unlike \f(CW\*(C`hostfiles\*(C'\fR, paths and directories in the base image
don't need to have any relationship to the host filesystem.
.SS "\s-1RECONSTRUCTING\s0 \s-1THE\s0 \s-1APPLIANCE\s0"
.IX Subsection "RECONSTRUCTING THE APPLIANCE"
The separate tool \fIfebootstrap\-supermin\-helper\fR\|(8) is used to
reconstruct an appliance from the hostfiles and base image files.
.PP
This program in fact iterates recursively over the files and
directories passed to it.  A common layout is:
.PP
.Vb 4
\& supermin.d/
\& supermin.d/base.img
\& supermin.d/extra.img
\& supermin.d/hostfiles
.Ve
.PP
and then invoking febootstrap-supermin-helper with just the
\&\f(CW\*(C`supermin.d\*(C'\fR directory path as an argument.
.PP
In this way extra files can be added to the appliance just by creating
another cpio file (\f(CW\*(C`extra.img\*(C'\fR in the example above) and dropping it
into the directory.  When the appliance is constructed, the extra
files will appear in the appliance.
.PP
\fI\s-1DIRECTORIES\s0 \s-1BEFORE\s0 \s-1FILES\s0\fR
.IX Subsection "DIRECTORIES BEFORE FILES"
.PP
In order for febootstrap-supermin-helper to run quickly, it does not
know how to create directories automatically.  Inside hostfiles and
the cpio files, directories must be specified before any files that
they contain.  For example:
.PP
.Vb 3
\& /usr
\& /usr/sbin
\& /usr/sbin/serviced
.Ve
.PP
It is fine to list the same directory name multiple times.
.PP
\fI\s-1LEXICOGRAPHICAL\s0 \s-1ORDER\s0\fR
.IX Subsection "LEXICOGRAPHICAL ORDER"
.PP
febootstrap-supermin-helper visits the supermin control files in
lexicographical order.  Thus in the example above, in the order
\&\f(CW\*(C`base.img\*(C'\fR \-> \f(CW\*(C`extra.img\*(C'\fR \-> \f(CW\*(C`hostfiles\*(C'\fR.
.PP
This has an important effect: files contained in later cpio files
overwrite earlier files, and directories do not need to be specified
if they have already been created in earlier control files.
.PP
\fI\s-1EXAMPLE\s0 \s-1OF\s0 \s-1CREATING\s0 \s-1EXTRA\s0 \s-1CPIO\s0 \s-1FILE\s0\fR
.IX Subsection "EXAMPLE OF CREATING EXTRA CPIO FILE"
.PP
You can create a file like \f(CW\*(C`extra.img\*(C'\fR very easily using a shell
snippet similar to this one:
.PP
.Vb 6
\& cd $tmpdir
\& mkdir \-p usr/sbin
\& cp /path/to/serviced usr/sbin/
\& echo \-e "usr\enusr/sbin\enusr/sbin/serviced" |
\&   cpio \-\-quiet \-o \-H newc > extra.img
\& rm \-rf usr
.Ve
.PP
Notice how we instruct cpio to create intermediate directories.
.SS "\s-1MINIMIZING\s0 \s-1THE\s0 \s-1SUPERMIN\s0 \s-1APPLIANCE\s0"
.IX Subsection "MINIMIZING THE SUPERMIN APPLIANCE"
You may want to \*(L"minimize\*(R" the supermin appliance in order to save
time and space when it is instantiated.  Typically you might want to
remove documentation, info files, man pages and locales.  We used to
provide a separate tool called \f(CW\*(C`febootstrap\-minimize\*(C'\fR for this
purpose, but it is no longer provided.  Instead you can post-process
\&\f(CW\*(C`hostfiles\*(C'\fR yourself to remove any files or directories that you
don't want (by removing lines from the file).  Be careful what you
remove because files may be necessary for correct operation of the
appliance.
.PP
For example:
.PP
.Vb 5
\& < supermin.d/hostfiles \e
\& grep \-v \*(Aq^/usr/share/man/\*(Aq |
\& grep \-v \*(Aq^/usr/share/doc/\*(Aq |
\& grep \-v \*(Aq^/usr/share/info/\*(Aq > supermin.d/hostfiles\-t
\& mv supermin.d/hostfiles\-t supermin.d/hostfiles
.Ve
.SS "\s-1KERNEL\s0 \s-1AND\s0 \s-1KERNEL\s0 \s-1MODULES\s0"
.IX Subsection "KERNEL AND KERNEL MODULES"
Usually the kernel and kernel modules are \fInot\fR included in the
supermin appliance.  When the appliance is instantiated, the kernel
modules from the host kernel are copied in, and it is booted using the
host kernel.
.PP
febootstrap-supermin-helper is able to choose the best host kernel
available to boot the appliance.  Users can override this by setting
environment variables (see \fIfebootstrap\-supermin\-helper\fR\|(8)).
.SS "\s-1BOOTING\s0 \s-1AND\s0 \s-1CACHING\s0 \s-1THE\s0 \s-1SUPERMIN\s0 \s-1APPLIANCE\s0"
.IX Subsection "BOOTING AND CACHING THE SUPERMIN APPLIANCE"
For fastest boot times you should cache the output of
febootstrap-supermin-helper.  See the libguestfs source file
\&\f(CW\*(C`src/appliance.c\*(C'\fR for an example of how this is done.
.SS "\s-1ENFORCING\s0 \s-1AVAILABILITY\s0 \s-1OF\s0 \s-1HOSTFILES\s0"
.IX Subsection "ENFORCING AVAILABILITY OF HOSTFILES"
febootstrap-supermin-helper builds the appliance by copying in host
files as listed in \f(CW\*(C`hostfiles\*(C'\fR.  For this to work those host files
must be available.  We usually enforce this by adding requirements
(eg. \s-1RPM\s0 \f(CW\*(C`Requires:\*(C'\fR lines) on the package that uses the supermin
appliance, so that package cannot be installed without pulling in the
dependent packages and thus making sure the host files are available.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIfebootstrap\-supermin\-helper\fR\|(8),
<http://people.redhat.com/~rjones/febootstrap/>,
\&\fIguestfs\fR\|(3),
<http://libguestfs.org/>.
.SH "AUTHORS"
.IX Header "AUTHORS"
.IP "\(bu" 4
Richard W.M. Jones <http://people.redhat.com/~rjones/>
.IP "\(bu" 4
Matthew Booth mbooth@redhat.com
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
Copyright (C) 2009\-2011 Red Hat Inc.
.PP
This program is free software; you can redistribute it and/or modify
it under the terms of the \s-1GNU\s0 General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.
.PP
This program is distributed in the hope that it will be useful,
but \s-1WITHOUT\s0 \s-1ANY\s0 \s-1WARRANTY\s0; without even the implied warranty of
\&\s-1MERCHANTABILITY\s0 or \s-1FITNESS\s0 \s-1FOR\s0 A \s-1PARTICULAR\s0 \s-1PURPOSE\s0.  See the
\&\s-1GNU\s0 General Public License for more details.
.PP
You should have received a copy of the \s-1GNU\s0 General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 675 Mass Ave, Cambridge, \s-1MA\s0 02139, \s-1USA\s0.
