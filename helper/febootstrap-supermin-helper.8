.\" Automatically generated by Pod::Man 2.23 (Pod::Simple 3.14)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "FEBOOTSTRAP-SUPERMIN-HELPER 8"
.TH FEBOOTSTRAP-SUPERMIN-HELPER 8 "2010-12-07" "febootstrap-3.1" "Virtualization Support"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
febootstrap\-supermin\-helper \- Reconstruct initramfs from supermin appliance.
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 2
\& febootstrap\-supermin\-helper supermin.img hostfiles.txt host_cpu kernel initrd
\& febootstrap\-supermin\-helper input [...] host_cpu kernel initrd
\&
\& febootstrap\-supermin\-helper \-f ext2 input [...] host_cpu kernel initrd appliance
\&
\& febootstrap\-supermin\-helper \-f checksum input [...] host_cpu
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fIfebootstrap-supermin-helper\fR reconstructs a bootable kernel and
initramfs from a supermin appliance.  First you should be familiar
with \fIfebootstrap\fR\|(8).
.SH "PARAMETERS"
.IX Header "PARAMETERS"
Of the required parameters, the first few are \fIinput\fR files, and the
last two or three are \fIoutput\fR files.
.PP
\&\f(CW\*(C`supermin.img\*(C'\fR and \f(CW\*(C`hostfiles.txt\*(C'\fR are the input files which
describe the supermin appliance.  (You can also use a directory name
here which is searched for files).
.PP
\&\f(CW\*(C`host_cpu\*(C'\fR should be the host \s-1CPU\s0, eg. \f(CW\*(C`x86_64\*(C'\fR or \f(CW\*(C`i686\*(C'\fR.
.PP
\&\f(CW\*(C`kernel\*(C'\fR, \f(CW\*(C`initrd\*(C'\fR and \f(CW\*(C`appliance\*(C'\fR are the temporary output files
that this script produces.  These output files are meant to be used
just for booting the appliance, and should be deleted straight
afterwards.  The extra \f(CW\*(C`appliance\*(C'\fR parameter is only required when
the format is \f(CW\*(C`ext2\*(C'\fR.  None of these parameters are needed for
the checksum output \f(CW\*(C`\-f checksum\*(C'\fR.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-f fmt\fR | \fB\-\-format fmt\fR" 4
.IX Item "-f fmt | --format fmt"
Select the output format for the appliance.  Possible formats are:
.RS 4
.IP "cpio" 4
.IX Item "cpio"
A Linux initramfs.  This is the default.
.Sp
In this case you have to supply names for the \f(CW\*(C`kernel\*(C'\fR
and \f(CW\*(C`initrd\*(C'\fR, where the \f(CW\*(C`initrd\*(C'\fR is the appliance.
.IP "ext2" 4
.IX Item "ext2"
An ext2 filesystem.
.Sp
In this case you have to supply names for the \f(CW\*(C`kernel\*(C'\fR, a small
\&\f(CW\*(C`initrd\*(C'\fR which is used just to locate the appliance, and the
\&\f(CW\*(C`appliance\*(C'\fR (the ext2 filesystem).
.IP "checksum" 4
.IX Item "checksum"
Output a checksum.
.Sp
This prints a checksum which only changes when one of the input files
changes.
.Sp
You can use this in order to cache the output of a previous run of
this program: computing the checksum is much quicker than building an
appliance, and you only need to invalidate the cache (and consequently
rebuild the appliance) when the checksum changes.  Note that the
host_cpu and the \s-1UID\s0 of the current user are included in the checksum.
.RE
.RS 4
.RE
.IP "\fB\-k file\fR | \fB\-\-kmods file\fR" 4
.IX Item "-k file | --kmods file"
If this option is specified, then \f(CW\*(C`file\*(C'\fR should be a list of
wildcards matching kernel module names, eg:
.Sp
.Vb 3
\& virtio*.ko
\& scsi*.ko
\& piix.ko
.Ve
.Sp
In this case, only kernel modules matching those wildcards will be
included in the output appliance.  Note: You must resolve any
dependencies yourself as this does not pull in dependent modules
automatically.
.Sp
If this option is not specified, then every kernel module from the
host will be included.  This is safer, but can produce rather large
appliances which need a lot more memory to boot.
.IP "\fB\-u user\fR | \fB\-\-user user\fR | \fB\-g group\fR | \fB\-\-group group\fR" 4
.IX Item "-u user | --user user | -g group | --group group"
Run febootstrap-supermin-helper as an alternate user and/or group.
\&\f(CW\*(C`user\*(C'\fR and \f(CW\*(C`group\*(C'\fR can be specified as either a name, which will
be resolved using the system name service, or a uid/gid.  Use of these
options requires root privileges.
.Sp
Use of these options is required if running febootstrap-supermin-helper
as root with the effective uid/gid set to non-root.  Bash will reset
the effective uid/gid to the real uid/gid when invoked.  As
febootstrap-supermin-helper uses bash in parts, this will result in the
creation of an appliance with a mixture of ownerships.
.SH "SPEED"
.IX Header "SPEED"
In libguestfs, on a mid-range Intel-based \s-1PC\s0, we reconstruct the
initramfs using this script in around 1/5th of a second (assuming a
\&\*(L"hot cache\*(R" \- it's rather slower when run the first time on a cold
cache).
.PP
Some tips to improve performance:
.IP "\(bu" 4
Use a kernel module whitelist (the \f(CW\*(C`\-\-kmods\*(C'\fR option), and only
list the kernel modules you really need.
.IP "\(bu" 4
Minimize the appliance, removing as much extraneous junk as possible.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIfebootstrap\fR\|(8).
.SH "AUTHORS"
.IX Header "AUTHORS"
Richard W.M. Jones <rjones @ redhat . com>
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
(C) Copyright 2009\-2010 Red Hat Inc.,
<http://people.redhat.com/~rjones/febootstrap>.
.PP
This program is free software; you can redistribute it and/or modify
it under the terms of the \s-1GNU\s0 General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.
.PP
This program is distributed in the hope that it will be useful,
but \s-1WITHOUT\s0 \s-1ANY\s0 \s-1WARRANTY\s0; without even the implied warranty of
\&\s-1MERCHANTABILITY\s0 or \s-1FITNESS\s0 \s-1FOR\s0 A \s-1PARTICULAR\s0 \s-1PURPOSE\s0.  See the
\&\s-1GNU\s0 General Public License for more details.
.PP
You should have received a copy of the \s-1GNU\s0 General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 675 Mass Ave, Cambridge, \s-1MA\s0 02139, \s-1USA\s0.
